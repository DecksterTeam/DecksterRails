//
//     KeyLines v1.9.11-1545
//
//     Copyright Â© 2011-2012 Cambridge Intelligence Limited. 
//     All rights reserved.
//

var KeyLines=KeyLines||{};


(function(){var a;typeof KeyLinesExports!="undefined"?a=exports:(this.KeyLines=this.KeyLines||{},a=this.KeyLines.Util={});var b=a.clone=function(a,c){if(a===null)return null;switch(typeof a){case"object":if(e(a)){var d=[];for(var f=0;f<a.length;f++)d.push(b(a[f],c));return d}if(a instanceof Date)return new Date(a.getTime());var g={};for(var h in a)if(!c||h.charAt(0)!=="_")g[h]=b(a[h],c);return g;case"boolean":case"string":case"number":return a}},c=a.isPlainObject=function(a){return!h(a)&&!d(a)&&!e(a)&&typeof a=="object"},d=a.isFunction=function(a){if(a){var b={}.toString.call(a);return b.slice(0,13)==="[object Funct"}return!1};a.isNormalObject=function(a){return typeof a=="object"&&!(a instanceof Date)&&!e(a)&&!h(a)};var e=a.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};a.invoke=function(a){a&&d(a)&&a()};var f=a.ensureArray=function(a){return e(a)?a:[a]},g=!0;a.timerFn=function(a,b){return function(){if(g){var c=(new Date).getTime(),d=a.apply(this,arguments),e=(new Date).getTime();return console.log("fn "+b+" = "+(e-c)+"ms"),d}return a.apply(this,arguments)}},a.defaults=function(a,c){var d=b(a)||{};for(var e in c)if(!d.hasOwnProperty(e)||h(d[e]))d[e]=c[e];return d};var h=a.isNullOrUndefined=function(a){return a===null?!0:typeof a=="undefined"?!0:!1},i=a.flattenMap=function(a){var b=[];for(var c in a)b.push(c+"");return b},j=a.rawId=function(a){if(h(a))return null;var b=a+"",c=b.lastIndexOf("#");return c!==-1&&(b=b.substring(0,c)),b};a.subId=function(a){if(!a)return null;var b=a+"",c=b.lastIndexOf("#");return c!==-1?b.substring(c+1):null};var k=a.makeIdMap=function(a){var b={};a=f(a);for(var c=0;c<a.length;c++)b[j(a[c])]=1;return b};a.uniqueList=function(a){var b=k(a)};var l=a.contains=function(a,b){return m(a,b)!==-1},m=a.indexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},n=a.merge=function(a,b){if(a){for(var c in b)a[c]=b[c];return a}return b},o=a.keys=function(a){var b={};for(var c in a)b[c]=1;return b},p=a.ensureId=function(a){return j(a)}})();


(function(){var a;typeof KeyLinesExports!="undefined"?a=exports:(this.KeyLines=this.KeyLines||{},a=this.KeyLines.DateTime={});var b={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"]},c=[31,28,31,30,31,30,31,31,30,31,30,31],d=a.units={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},e=function(a,b){return b?a-a%b:0},f=a.clone=function(a){return new Date(a.getTime())},g=function(a){if(a<d.milli||d.year<a)throw"bad unit range"},h=function(a,b){return a===1&&i(b)?29:c[a]},i=function(a){return(new Date(a,1,29)).getMonth()===1},j=a.clear=function(a,b,c){g(b);var h=f(a);b>d.milli&&h.setMilliseconds(0),b>d.sec&&h.setSeconds(0),b>d.min&&h.setMinutes(0),b>d.hour&&h.setHours(0),b>=d.month&&h.setDate(1),b>=d.year&&h.setMonth(0);switch(b){case d.milli:h.setMilliseconds(e(h.getMilliseconds(),c));break;case d.sec:h.setSeconds(e(h.getSeconds(),c));break;case d.min:h.setMinutes(e(h.getMinutes(),c));break;case d.hour:h.setHours(e(h.getHours(),c));break;case d.day:h.setDate(1);break;case d.week:var i=h.getDay(),j=i<1?6:i-1;h.setTime(h.getTime()-j*24*60*60*1e3);break;case d.month:h.setMonth(e(h.getMonth(),c));break;case d.year:h.setFullYear(e(h.getFullYear(),c))}return h},k=a.add=function(a,b,c){g(b);var e=f(a);if(b>d.week)switch(b){case d.month:var l=e.getMonth()+c,m=l%12,n=Math.floor(l/12);m<0&&(m+=12);var o=e.getDate();o=Math.min(o,h(m,e.getFullYear()+n)),e.setDate(o),e.setMonth(m),n!==0&&(e=k(e,d.year,n));break;case d.year:if(e.getMonth()===1&&e.getDate()===29){var p=e.getFullYear()+c;i(p)||(e=k(e,d.day,-1))}e.setFullYear(e.getFullYear()+c)}else{var j=c;b>d.milli&&(j*=1e3),b>d.sec&&(j*=60),b>d.min&&(j*=60),b>d.hour&&(j*=24),b>d.day&&(j*=7),e.setTime(e.getTime()+j)}return e},l=function(a){var b=a+"";while(b.length<2)b="0"+b;return b},m=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),n={f:function(a){return Math.floor(a.getMilliseconds()/100)},ff:function(a){return l(Math.floor(a.getMilliseconds()/10))},fff:function(a){return l(Math.floor(a.getMilliseconds()))},s:function(a){return a.getSeconds()},ss:function(a){return l(a.getSeconds())},m:function(a){return a.getMinutes()},mm:function(a){return l(a.getMinutes())},h:function(a){return 1+a.getHours()%12},hh:function(a){return l(1+a.getHours()%12)},H:function(a){return a.getHours()},HH:function(a){return l(a.getHours())},t:function(a){return b.ampm[Math.floor(a.getHours()/12)][0]},tt:function(a){return b.ampm[Math.floor(a.getHours()/12)]},d:function(a){return a.getDate()},dd:function(a){return l(a.getDate())},ddd:function(a){return b.shortDays[a.getDay()]},dddd:function(a){return b.longDays[a.getDay()]},M:function(a){return a.getMonth()+1},MM:function(a){return l(a.getMonth()+1)},MMM:function(a){return b.shortMonths[a.getMonth()]},MMMM:function(a){return b.longMonths[a.getMonth()]},MMMMM:function(a){return b.shortMonths[a.getMonth()].substr(0,1)},Q:function(a){var b=a.getMonth(),c=Math.floor(b/3)+1;return"Q"+c},QQ:function(a){var b=a.getMonth(),c=Math.floor(b/6)+1;return"H"+c},yyyy:function(a){return a.getFullYear()},yy:function(a){return l(a.getFullYear()%100)}},o=a.format=function(a,b){return b.replace(m,function(b){return n[b](a)})},p="(?::)?",q="(?:-|$)",r="(?:T|$)",s=function(a,b){return a[b]?parseInt(a[b],10):undefined},t=function(a,b,c,d){var e=s(a,b);return u(e)?c>e||e>d?undefined:e:c},u=function(a){return typeof a!="undefined"},v=new RegExp("^(\\d{4})"+q+"(\\d{2})?"+q+"(\\d{2})?"+r+"(\\d{2})?"+p+"(\\d{2})?"+p+"(\\d{2})?"+"(?:Z)?"+"(\\+|-)?"+"(\\d{2})?"+p+"(\\d{2})?"+""),w=a.parseISO8601=function(a){var b=v.exec(a);if(b){var c=s(b,1),d=t(b,2,1,12),e=t(b,3,1,31),f=t(b,4,0,23),g=t(b,5,0,59),i=t(b,6,0,59),j=b[7]==="-"?-1:1,k=t(b,8,0,12),l=t(b,9,0,59);if(!(u(c)&&u(d)&&u(e)&&u(f)&&u(g)&&u(i)&&u(k)&&u(l)))return;if(e>h(d-1,c))return;var m=new Date(c,d-1,e,f,g,i),n=j*(k*60+l)*60*1e3;return m.setTime(m.getTime()-n),m}return}})();


(function(){function c(a,b,c,d){d||(d=!1),a.addEventListener?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)}function e(a){return a.pageX?a.pageX:a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}function f(a){return a.pageY?a.pageY:a.clientY+document.body.scrollTop+document.documentElement.scrollTop}function h(a){return document.addEventListener&&W()&&document.hasOwnProperty("webkitIsFullScreen")&&a.offsetParent!==null&&a.offsetParent.nodeName==="BODY"?!1:!0}function i(a,b){var c=[];for(var e=0;e<a[b].length;e++){var f=d(a[b][e]);c.push({id:a[b][e].identifier,x:f.x,y:f.y})}return c}function j(a){return a.target?a.target:a.srcElement}function k(a){var c=j(a),d=c.id;d in b&&(b[d].canvas||a.button!==0&&(l(d,c,a.button,a),m(a)))}function l(a,c,e,f){var g=c.getStageWidth()/c.width,h=L(a);g/=h;var i=d(f);b[a].privateFlashClick(e),b[a].mousedown(e,i.x*g,i.y*g,f.ctrlKey,f.shiftKey)}function m(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1,a.preventCapture&&a.preventCapture(),a.preventBubble&&a.preventBubble()}function n(){function a(a){var c=a.wheelDelta?a.wheelDelta:-a.detail,e=j(a),f=b[e.id];if(f){var g=d(a);f.mousewheel(c,g.x,g.y),m(a)}}c(window,"mousedown",k,!0),c(document,"contextmenu",function(a){if(j(a).id in b)return m(a),!1}),"ontouchstart"in document.documentElement||navigator.msMaxTouchPoints>0?(c(document,"touchstart",function(a){a.target.id in b&&(b[a.target.id].touchstart(i(a,"targetTouches"),i(a,"changedTouches")),a.preventDefault())}),c(document,"touchmove",function(a){a.target.id in b&&b[a.target.id].touchmove(i(a,"targetTouches"),i(a,"changedTouches"))}),c(document,"touchend",function(a){a.target.id in b&&b[a.target.id].touchend(i(a,"targetTouches"),i(a,"changedTouches"))}),c(document,"touchcancel",function(a){a.target.id in b&&b[a.target.id].touchcancel(i(a,"targetTouches"),i(a,"changedTouches"))}),c(document,"gesturestart",function(a){a.target.id in b&&(b[a.target.id].gesturestart(),a.preventDefault())}),c(document,"gesturechange",function(a){a.target.id in b&&(b[a.target.id].gesturechange(a.scale,a.rotation),a.preventDefault())}),c(document,"gestureend",function(a){a.target.id in b&&(b[a.target.id].gestureend(a.scale,a.rotation),a.preventDefault())})):(c(window,"mousedown",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=d(a);b[a.target.id].mousedown(a.button,c.x,c.y,a.ctrlKey,a.shiftKey)}}),c(window,"mouseup",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=d(a);b[a.target.id].mouseup(c.x,c.y,a.ctrlKey,a.shiftKey)}}),c(window,"mousemove",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=d(a);b[a.target.id].mousemove(c.x,c.y,a.ctrlKey,a.shiftKey)}}),c(window,"dblclick",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=d(a);b[a.target.id].dblclick(c.x,c.y,a.ctrlKey,a.shiftKey),a.preventDefault()}}),c(window,"mouseleave",function(a){if(a.target.id in b&&b[a.target.id].canvas){var c=d(a);b[a.target.id].mouseleave()}})),c(document,"mousewheel",a),c(document,"DOMMouseScroll",a),c(document,"keyup",function(a){for(var c in b)b[c].canvas&&b[c].keyup(a.keyCode)}),c(document,"keydown",function(a){var c=!1;for(var d in b)b[d].canvas&&(c|=b[d].keydown(a.keyCode,a.ctrlKey,a.shiftKey));c&&a.preventDefault&&a.preventDefault()})}function o(a){a in b&&delete b[a]}function p(a){b[a].id=function(){return a}}function q(a){a in b||(b[a]={})}function s(a){r++;var b="sink"+r;return KeyLines[b]=function(){return a.apply(this,arguments)},"KeyLines."+b}function t(b,c,d,e,f){var g;if(e.length>0){var h=e[e.length-1];a.isFunction(h)&&(g=s(h),e.pop())}return c[b](d,e,g,f)}function u(a){function e(a,b,c,e){b[c]=function(){var b=[].slice.call(arguments);return t(a,d,c,b,e)}}var c=b[a],d=document.getElementById(a);c.bind=function(a,b){var c=s(b);d.privateBind(c,a)};var f=d.privateGetMethodsWithCallbacks();for(var g=0;g<f.length;g++)e("callAnything",c,f[g]);var h={graph:{},combo:{}};for(var i in h){var j=d.privateNamespaceNames(i);for(var k=0;k<j.length;k++)e("callAnything",h[i],j[k],i)}c.graph=function(){return h.graph},c.combo=function(){return h.combo}}function v(a){var b=document.getElementById(a),c=b.parentNode;return!c.addEventListener}function w(c){var d=b[c];d.layout=function(b,e,f){b||(b="standard");var g=d.viewOptions(),h=g.height>0?g.width/g.height:1;e=a.defaults(e,{fit:!0,animate:!0,tidy:!0,ratio:h,tightness:5}),v(c)&&(e.flash=!0);if(e.flash&&!d.canvas)d.directLayout(b,e,f);else{var i={trigger:function(a,b,c){d.trigger(a,b,c)}},j=d.layoutStructure(b,e);KeyLines.Layouts.layout(b,i,j,e,!1,function(a,b){d.finishLayout(a,b,f)})}}}function x(c){var d=b[c];d.arrange=function(b,c,e,f){b||(b="grid"),e=a.defaults(e,{fit:!1,animate:!0,tidy:!1,ratio:1});var g={trigger:function(a,b,c){d.trigger(a,b,c)}},h=d.layoutStructure(b,e);KeyLines.Layouts.arrange(b,g,c,h,e,function(a,b){d.finishLayout(a,b,f)})}}function y(c){var d=b[c];d.createLink=function(b,c,e,f){function k(b,e,g,i){var j=!e||KeyLines.Util.rawId(e)===c,l=d.getItem(e)&&j?e:null;j&&b==="dummy"&&h&&d.removeItem([c,h]),d.unbind("dragcomplete",k),f&&a.isFunction(f)&&f(l)}var g=d.getItem(b);if(!b||!g||g.type!=="node")return;if(!c)return;c=a.ensureId(c),e=a.defaults(e,{style:{}}),d.bind("dragcomplete",k);var h="dummyEnd"+Math.floor(Math.random()*1e7),i={type:"node",du:!0,id:h,x:g.x,y:g.y},j={id:c,id2:h,id1:b,type:"link"};j=KeyLines.Util.merge(e.style,j),d.merge([i,j],function(){setTimeout(function(){d.startDragger(c,h+"#id2",g.x,g.y)},50)})}}function z(c){var d=b[c];d.expand=function(b,c,e){function f(a,b,c){var e,f,g,h,i,j,k,l=[],m=[];while(a.length){k=a.pop();var n=d.getItem(k.id);if(k.type==="node"&&!b[k.id]&&n){m.push(k.id),f=d.graph().neighbours(k.id),h=i=j=0;for(var o=0;o<f.nodes.length;o++)g=f.nodes[o],b[g]&&(j++,h+=b[g].x,i+=b[g].y);l.push({id:k.id,x:j?h/j:h,y:j?i/j:i})}}d.setProperties(l,!1,c)}function g(){var a=[],b={};return d.each({type:"node"},function(c){a.push(c.id);if(d.combo().isCombo(c.id)){var e=d.combo().info(c.id).nodes;KeyLines.Util.merge(b,KeyLines.Util.makeIdMap(e))}b[c.id]=c}),{list:a,dict:b}}function h(a,b){var c=[],d={};for(var e=0;e<a.length;e++)!d[a[e].id]&&!KeyLines.Util.isNullOrUndefined(a[e])&&(d[a[e].id]=1,delete a[e].x,delete a[e].y,c.push(a[e]));return c}function i(){var a={fixed:l,animate:!!c.animate,ms:c.time,tightness:c.tightness,tidy:c.tidy,fit:c.fit,strategy:"spiral"},b=d.layoutStructure("standard",a);KeyLines.Layouts.layout("standard",j,b,a,!1,function(a,b){d.finishLayout(a,b,e)})}c=a.defaults(c,{fit:!1,tidy:!1,animate:!0,tightness:5,time:1e3});var j={trigger:function(a,b,c){d.trigger(a,b,c)}};b=KeyLines.Util.ensureArray(b),j.trigger("prechange","expand");var k=g(),l=k.list,m=k.dict;b=h(b,m),d.merge(b,function(){f(b,m,i)})}}function A(a,b){return function(){var c=document.getElementById(a);switch(arguments.length){case 0:return c[b]();case 1:return c[b](arguments[0]);case 2:return c[b](arguments[0],arguments[1]);case 3:return c[b](arguments[0],arguments[1],arguments[2]);case 4:return c[b](arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return c[b](arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}}}function H(){return typeof KeyLines.Canvas!="undefined"}function K(a,b){return a==="all"||a===b.type}function L(a){var b=document.getElementById(a);if(b)return b.clientWidth/Number(b.width)}function M(a){var b=document.getElementById(a),d=b.parentNode;d.addEventListener||(c(d,"mousedown",function(c){if(c.button>1){d.setCapture();var e=c.button<4?2:1;l(a,b,e,c)}},!0),c(d,"mouseup",function(a){d.releaseCapture()},!0))}function N(a){ba(a),O[a]&&P[a]&&(O[a]=!1,P[a]=!1,M(a),J(a),x(a),z(a),y(a),Q[a]&&Q[a](null,b[a]))}function R(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("script");c.type="text/javascript",c.src=S,c.onreadystatechange=a,c.onload=a,b.appendChild(c)}function W(){return document.hasOwnProperty("webkitIsFullScreen")?document.webkitIsFullScreen:typeof document.mozFullScreen!="undefined"?document.mozFullScreen:document.fullScreenElement&&document.fullScreenElement!==null}function X(a){if(document.hasOwnProperty("webkitCurrentFullScreenElement"))return document.webkitCurrentFullScreenElement===a;if(typeof document.mozFullScreenElement!="undefined")return document.mozFullScreenElement===a}function Y(){return typeof document.mozFullScreen!="undefined"}function $(){Y()&&_()}function _(){}function ba(a){}function bb(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()}function bc(a){bd&&bd(W())}var a=typeof KeyLinesRequire!="undefined"?require("./util"):this.KeyLines.Util,b=KeyLines.charts={};n();var d=KeyLines.coords=function(a){var b=g(j(a).id),c=Math.floor(e(a)-b.left),d=Math.floor(f(a)-b.top);return{x:c,y:d}},g=KeyLines.getOffset=function(a){var b=document.getElementById(a),c=0,d=0;do h(b)&&(c+=b.offsetLeft,d+=b.offsetTop),b=b.offsetParent;while(b);return{left:c,top:d}};KeyLines.initializeFlashBroker=function(a){q(a);var c=b[a];for(var d in c)c[d]=A(a,d);p(a),u(a),w(a),c.canvas=!1,c.ready=!0};var r=0;KeyLines.addFlashFunction=function(a,c){q(a),b[a][c]={}};var B="auto",C=KeyLines.mode=function(a){return a&&(B=a),B};KeyLines.createChart=function(){var a,b,c,d;switch(arguments.length){case 0:throw"createChart called with zero arguments";case 1:case 2:a=arguments[0],d=arguments[1];var e=document.getElementById(a);b=e.clientWidth,c=e.clientHeight;break;default:a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]}b||(b=100),c||(c=100);var f=B!=="flash";if(f&&G()&&H())I(a,b,c,d);else{if(B==="canvas"){var g="Could not create HTML5 canvas. Try using auto or flash mode.";d(g);return}V(a,b,c,d)}};var D,E=KeyLines.setCanvasPaths=function(a){D=a},F;KeyLines.imageBasePath=function(a){return a&&(F=a),F},E("assets/");var G=KeyLines.html5CanvasSupport=function(){var a=document.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},I=function(a,c,d,e){o(a),q(a);var f=document.getElementById(a);b[a]=KeyLines.Canvas.create(a,c,d,D,F),p(a),w(a),J(a),x(a),z(a),y(a),e&&e(null,b[a])},J=function(c){b[c].each=function(d,e){var f=b[c].serialize().items;d=a.defaults(d,{type:"all"});if(!d.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");if(a.isFunction(e))for(var g=0;g<f.length;g++)K(d.type,f[g])&&e(f[g])}};KeyLines.flashInitialized=function(a){P[a]=!0,N(a)},KeyLines.setSize=function(a,c,d){if(c<=0||d<=0)return;var e=document.getElementById(a);e&&(e.style.height=d+"px",e.style.width=c+"px",b[a]&&b[a].canvas&&b[a].setSize(c,d,1))},KeyLines.getElementWidth=function(a){var b=document.getElementById(a);if(b)return b.clientWidth};var O={},P={},Q={},S,T,U;KeyLines.setFlashPaths=function(a,b,c){T=a,S=b,U=c};var V=function(a,b,c,d){o(a),Q[a]=d,O[a]=!1,P[a]=!1,R(function(){var e={identifier:a},f={menu:"false",quality:"best",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"},g={};typeof swfobject!="undefined"&&(O[a]||swfobject.embedSWF(T,a,b,c,"10.0.0",U,e,f,g,function(b){b.success?(O[a]=!0,N(a)):d("swfobject embedSWF returned error "+b)}))})};document.addEventListener&&(document.addEventListener("fullscreenchange",bc,!1),document.addEventListener("mozfullscreenchange",bc,!1),document.addEventListener("webkitfullscreenchange",bc,!1));var Z={};KeyLines.fullScreenCapable=function(){return document.addEventListener?document.hasOwnProperty("webkitCurrentFullScreenElement")?!0:typeof document.mozFullScreenElement!="undefined"?!0:!1:!1};var bd;KeyLines.toggleFullScreen=function(a,b){if(!document.addEventListener)return;$(),bd=b,W()?X(a)?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():bb(a):bb(a)}})();


(function(){function c(a,b,c,d,e,f){d?a[b]=c[b]:a[b]={x:e,y:f}}function d(a,b,d,g,h){var i=1.25-(I(d.tightness)-5)/10,j=f(b.v,b.e),k=e(j,b.v,i);U(a,k,d,g,function(a,d,e){var f={};for(var g in a.vertices)if(j.rev[g]){var i=a.vertices[g].fixed;for(var k=0;k<j.rev[g].length;k++){var l=j.rev[g][k],m=a.vertices[g].x+a.vertices[g].jit.positions[l].x,n=a.vertices[g].y+a.vertices[g].jit.positions[l].y;c(f,l,b.v,i,m,n)}}else c(f,g,b.v,b.v[g].fixed,a.vertices[g].x,a.vertices[g].y);var o={vertices:f,extents:a.extents};h(o,d,e)})}function e(a,b,c){var d={},e=[],f=0;for(var g in a.rev){var h={};h.x=h.y=h.size=0;var i=a.rev[g].length,j=!1;for(var l=0;l<i;l++){var m=b[a.rev[g][l]];h.x+=m.x,h.y+=m.y,h.size+=m.size}h.x=h.x/i,h.y=h.y/i;var n=k(b,a.rev[g],h.size/i,c);d[g]={x:h.x,y:h.y,size:n.radius,fixed:j,jit:n},f++;var o=a.rev[g][0],p={},q=a.index[o];for(var r=0;r<q.length;r++){var s=q[r];p[a.ids[s]]=1}for(var t in p)g<t&&e.push({id1:g,id2:t})}for(var u in b)if(!a.ids[u]){var v=b[u];d[u]={x:v.x,y:v.y,size:v.size,fixed:v.fixed,jit:{radius:v.size,position:{x:0,y:0}}},f++}return{v:d,e:e,vcount:f,extents:A(d)}}function f(a,b){var c=i(b);return j(c)}function g(a,b,c){a[c]||(a[c]=[]),a[c].push(b)}function h(a,b){g(a,b.id1,b.id2),g(a,b.id2,b.id1)}function i(a){var b={};for(var c=0;c<a.length;c++)h(b,a[c]);return b}function j(a){var b={},c={},d;for(var e in a){a[e].sort(),d="";for(var f=0;f<a[e].length;f++)d+=a[e][f];b[d]||(b[d]=[]),b[d].push(e),c[e]=d}return{rev:b,ids:c,index:a}}function k(a,b,c,d){var e={},f=0,g,h=b.length-1;do g=l(a,b,c,h,e,d),f=Math.max(g.radius,f),h=g.index;while(h>=0);var i;switch(b.length){case 4:i=2;break;case 3:i=2.5;break;case 2:i=3;break;case 1:i=1;break;default:i=2}return{positions:e,radius:f*i}}function l(a,b,c,d,e,f){if(d===0)return e[b[0]]={x:0,y:0},{radius:c,index:-1};var g=(d+1)*c,h=c,i=Math.sqrt(g/(Math.PI*h)),j=i*h,k=Math.floor(2*Math.PI*j/c);k=Math.min(k,d+1);var l=Math.PI*2/k,m=0;switch(k){case 2:m=Math.PI/2,j*=.75;break;case 3:m=Math.PI/3,j*=.85;break;case 4:m=0,j*=.85;break;case 5:m=0,j*=.9;break;default:m=0}j*=f;var n=0;while(n<k)e[b[d-n]]={x:j*Math.cos(m),y:j*Math.sin(m)},m+=l,n++;return d-=k,{radius:j,index:d}}function m(a,b,c,d){var e=0,f={},g;for(g=0;g<b.length;g++)e+=a[b[g]].size;if(b.length===1)f[b[0]]={x:0,y:0};else{var h=Math.PI/4;b.length===2&&(h=Math.PI/2),b.length===4&&(h=0),b.length<4&&(e*=1.5);var i=Math.PI*2/b.length,j=d*e/4;for(g=0;g<b.length;g++)f[b[g]]={x:j*Math.cos(h),y:j*Math.sin(h)},h+=i}return{positions:f,radius:e}}function q(a,b){function c(a,b){return e(a.link)-e(b.link)}function e(a){var b=bf(a.off)?a.off:d;return a.id1>=a.id2&&(b=-b),b}function f(a,b){a.id1<a.id2?a.off=b:a.off=-b}var d=1e6,g;for(var h in b)g=a[h],g.sort(c);for(h in b){g=a[h];var i=Math.floor(g.length/2),j=(g.length+1)%2/2;for(var k=0;k<g.length;k++)f(g[k].link,(k-i+j)*n)}}function s(a,b,c,d){if(a.w&&a.h)return C(a.w,a.h);if(a.du)return 10;var e=26,f=e*(a.e?a.e:1),g=c.nodeTextWidth(a,b);if(d){var h=f+g.height/2,i=g.width/2;return C(i,h)}return f+g.height/2}function t(a,b,c,d,e,f,g,h,i){var j=e[g];if(!(j in c)){if(!(j in d))throw"link has end which is not in nodes list";var k=d[j];if(k.hi)throw"link has end which is hidden";c[j]=u(a,b,k,j,h,i)}return j}function u(a,b,c,d,e,f){return{x:c.x,y:c.y,size:s(c,b,a,f),fixed:e?d in e:!1}}function v(a,b,c,d,e,f){var g=r(d),h={},i=[];for(var j=0;j<g.length;j++){var k=g[j][0].link,l=g[j][0].id,m=t(a,b,h,c,k,l,"id1",e,f),n=t(a,b,h,c,k,l,"id2",e,f);m!==null&&n!==null&&i.push({id1:m,id2:n,id:l})}for(var o in c)if(!c[o].hi&&!h[o]){var p=u(a,b,c[o],o,e,f);h[o]=p}var q=0;for(o in h)q++;return{v:h,e:i,vcount:q}}function w(a,b){var c=0,d=[],e;for(var f in a)if(!a[f].hasOwnProperty("c")){var g=c++;d.push(f+"");while(d.length>0){var h=d.shift();if(!a[h].hasOwnProperty("c")){a[h].c=g;for(e=0;e<b.length;e++)b[e].id1===h&&(b[e].c=g,d.push(b[e].id2)),b[e].id2===h&&(b[e].c=g,d.push(b[e].id1))}}}var i=new Array(c);for(var j=0;j<i.length;j++)i[j]={verts:{},edges:[]};for(f in a)i[a[f].c].verts[f]=a[f];for(e=0;e<b.length;e++)i[b[e].c].edges.push(b[e]);for(var k=0;k<i.length;k++)i[k].extents=A(i[k].verts);return i}function y(a){var b=[];for(var c in a.v)b.push({id:c,v:a.v[c]});a.v=b}function z(a){var b={};for(var c=0;c<a.v.length;c++)b[a.v[c].id]=a.v[c].v;a.v=b}function A(a){var b,c,d,e,f=0;for(var g in a){var h=a[g];b=b?Math.min(b,h.x-h.size):h.x-h.size,c=c?Math.min(c,h.y-h.size):h.y-h.size,d=d?Math.max(d,h.x+h.size):h.x+h.size,e=e?Math.max(e,h.y+h.size):h.y+h.size,f++}return{x1:b,y1:c,x2:d,y2:e,c:f}}function B(a,b){return C(a.x-b.x,a.y-b.y)}function C(a,b){return Math.max(bc,Math.sqrt(a*a+b*b))}function D(a){function b(a,b){return a.len<b.len}var c=[];for(var d in a)for(var e in a)d!==e&&d<e&&c.push({len:B(a[d],a[e]),text:d+"-"+e});c.sort(b);for(var f=0;f<c.length;f++)console.log(c[f].len+":"+c[f].text)}function E(a,b,c){function e(a,b){d.push({id:a+"",level:b})}var d=[];for(var f=0;f<c.length;f++){var g=c[f];e(g,0);while(d.length>0){var h=d.shift(),i=a[h.id].hasOwnProperty("level")?a[h.id].level>=h.level:!0;if(i){a[h.id].level=h.level;for(var j=0;j<b.length;j++)b[j].id1===h.id&&(b[j].level=h.level,e(b[j].id2,h.level+1)),b[j].id2===h.id&&(b[j].level=h.level,e(b[j].id1,h.level+1))}}}}function F(a,b){function d(a,b,d,e){c[a]=c[a]||[],c[a][b]=c[a][b]||{},c[a][b][d]=c[a][b][d]||[],c[a][b][d].push(e)}var c={};for(var e in a)a[e].hasOwnProperty("level")&&d(a[e].c,a[e].level,"vertices",e);for(var f=0;f<b.length;f++)b[f].hasOwnProperty("level")&&d(b[f].c,b[f].level,"edges",b[f]);return c}function G(a,b,c,d){for(var e in a)a[e].hasOwnProperty("level")&&(c[e].t=a[e].level);for(var f=0;f<b.length;f++)b[f].hasOwnProperty("level")&&(d[b[f].id].t=b[f].level)}function H(a,b){var c=[];for(var d=0;d<a.length;d++)b[a[d]]&&c.push(a[d]);return c}function I(a){var b=Number(a);return b=isNaN(b)?5:b,b=Math.max(0,b),b=Math.min(10,b),b}function J(a){return(5-I(a))*10}function K(a,c,d,e,f,g){function y(a,b){return h[a].x<h[b].x}function z(a,b){var c=[],d=p[a][b].vertices;for(var e=0;e<d.length;e++)c.push(p[a][b].vertices[e]);return c.sort(y),c}function A(a,b,c){p[a][b].ordered=c}function B(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}function C(a,b,c){var d=-1;for(var e=0;e<b.length;e++){if(b[e].id1===c){d=B(a,b[e].id2);if(d>-1)return d}if(b[e].id2===c){d=B(a,b[e].id1);if(d>-1)return d}}throw"bad index"}function D(a,b,c,d,e,f){var g=p[a][b].edges,h=f,i=C(c,g,e),j=0;for(var k=0;k<d.length;k++){var l=C(c,g,d[k]);(i<l&&h>k||i>l&&h<=k)&&j++}return j}function N(a,b,c){var d=[],e;for(var f=0;f<b.length;f++)b[f].id1===c&&(e=B(a,b[f].id2),e>-1&&d.push(e)),b[f].id2===c&&(e=B(a,b[f].id1),e>-1&&d.push(e));return d}function O(a){var b=a.length;return b===0?-1:(a[b-1]+a[0])/2}function P(a,b,c){function i(a,b){var c=d[a].v-d[b].v;return c===0&&(c=-(d[a].c-d[b].c),c===0&&(c=d[a].i-d[b].i)),c}var d={},e=[];for(var f=0;f<b.length;f++){var g=N(a,c,b[f]),h=O(g);d[b[f]]={v:h,c:g.length,i:f},e.push(b[f])}return e.sort(i),e}function Q(){for(var a in p){var b=p[a];for(var c=b.length-1;c>=1;c--){var d=b[c].edges,e=b[c].ordered,f=b[c-1].ordered,g=P(e,f,d);b[c-1].ordered=g}}}function R(){for(var a in p){var b=p[a];for(var c=0;c<b.length-1;c++){var d=b[c+1].edges,e=b[c].ordered,f=b[c+1].ordered,g=P(e,f,d);b[c+1].ordered=g}}}function T(){var a=0,b=0,c,d;for(d in p)for(var e=p[d].length-1;e>=0;e--){var f=p[d][e].ordered,g=[];for(var i=0;i<f.length;i++){var j=L(p,h,f[i]);h[f[i]].children=[],h[f[i]].subChildrenCount=0;if(j.length===0)a++;else{var k=[];for(c=0;c<j.length;c++)B(g,j[c])<0&&k.push(j[c]);if(k.length>0){h[f[i]].children=k,h[f[i]].subChildrenCount=U(k);for(c=0;c<k.length;c++)g.push(k[c]),h[k[c]].parent=f[i]}}b++}}}function U(a){var b=0;for(var c=0;c<a.length;c++){var d=h[a[c]].subChildrenCount;b+=d===0?1:d}return b}function X(a,b,c){c||(a.x=b);var d=b-a.subChildrenCount*V/2,e=a.children;if(e)for(var f=0;f<e.length;f++){var g=h[e[f]],i=g.subChildrenCount;i===0&&(i=1);var j=d+i*V;X(g,(j+d)/2,!1),d=j}}function Y(a,b){for(var c=0;c<p[a].length;c++){var d=p[a][c].ordered;for(var e=0;e<d.length;e++){var f=h[d[e]];f.y=b.miny+c*(t+12)*2}}}function $(a,b){var c={up:function(a){a.y=-a.y,a.x=-a.x},down:function(a){},right:function(a){var b=a.y;a.y=-a.x,a.x=b},left:function(a){var b=a.y;a.y=a.x,a.x=-b}},d=c[b]||c.down;for(var e=0;e<p[a].length;e++){var f=p[a][e].ordered;for(var g=0;g<f.length;g++)d(h[f[g]])}}var h=c.v,i=c.e,j=w(h,i),k=c.extents;d=b.defaults(d,{top:[],orientation:"down"});var l=g?1:J(d.tightness),m=j.length,n=d.top;n=H(n,h);var o=d.tidy;E(h,i,n);var p=F(h,i),q=0,r=0,s=26,t=0,u=0,v=0;for(var x in h)h[x].level===0&&(u+=1,q+=h[x].x,r+=h[x].y),h[x].hasOwnProperty("level")&&(s=Math.max(s,h[x].size),t+=h[x].size,v+=1);q/=u,r/=u,t/=v;for(var G in p){var I=z(G,0);A(G,0,I);for(var K=1;K<p[G].length;K++){var M=z(G,K);A(G,K,M)}}var S=3;while(S>0)Q(),R(),S--;T();var V=2*t+24+l,_={};for(G in p){var ba=bg(j[Number(G)].verts);_[Number(G)]=ba;var bb={children:p[G][0].ordered,subChildrenCount:U(p[G][0].ordered)};X(bb,ba.x,!0),Y(G,ba),g||$(G,d.orientation)}g&&g(h,p,j,_,t,d.tightness);var bc=[];o?W(a,h,j,0,1,k,bc,d,e,f):Z(a,h,k,bc,d,e,f)}function L(a,b,c){var d=b[c].c,e=b[c].level+1,f=a[d][e],g={},h=[];if(f){for(var i=0;i<f.edges.length;i++){var j=f.edges[i];j.id1===c&&(g[j.id2]=1),j.id2===c&&(g[j.id1]=1)}var k=f.ordered;for(var l=0;l<k.length;l++)g[k[l]]&&h.push(k[l])}return h}function M(a,b,c){return L(a,b,c).length>0}function N(a,c){var d={};for(var e=0;c&&e<c.length;e++){var f=c[e];b.contains(a,f.id1)&&!b.contains(a,f.id2)&&(d[f.id1]||(d[f.id1]={p:[]}),d[f.id1].p.push(f.id2)),b.contains(a,f.id2)>=0&&!b.contains(a,f.id1)&&(d[f.id2]||(d[f.id2]={p:[]}),d[f.id2].p.push(f.id1))}return d}function O(a,b,c,d,e,f){function g(a,b){return(a.r+b.r)/(a.a-b.a)}function h(a,b,c){var d=b>0?a+c:a+c/2;return d>0?d:a}function i(a,b,c,d){if(d&&a.length===1)return 0;var e=b,f=e;for(j=1;j<a.length;j++)f=Math.max(g(l[a[j]],l[a[j-1]]),f);return h(f,f-e,c)}var j,k,l;f=J(f);for(var m in b){var n=bg(c[Number(m)].verts),o=0,p=o,q=4*e,r=q,s=2*e+24;for(k=0;k<b[m].length;k++){var t=b[m][k].ordered,u;l=[];for(j=0;j<t.length;j++){u=a[t[j]];var v=u.x-n.minx,w=k===0?k+1:k,x=n.maxx-n.minx+s;v=2*Math.PI*v/x;if(v<0||v>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");l[t[j]]={a:v,r:u.size}}p=o,k===0?t.length>1&&(o+=q/2):o+=q,o=i(t,o,f,k<1),o-p>r&&(r=o-p+1,q=Math.max(q,r/2),k===0&&t.length<3&&(o/=2));var y={},z=[];for(j=0;j<t.length;j++){var A=Q(a,t[j]);A?(y[A]=y[A]||{parent:A,list:[]},y[A].list.push(t[j])):z.push(t[j])}var B=d[Number(m)];for(j=0;j<z.length;j++)P([z[j]],l,o,B,s,a);for(var C in y)P(y[C].list,l,o,B,s,a)}}}function P(a,b,c,d,e,f){var g=0,h,i,j;for(h=0;h<a.length;h++)g+=b[a[h]].a;g/=a.length,i=c>0?e/c:0,j=g-i*(a.length-1)/2;for(h=0;h<a.length;h++){var k=f[a[h]];k.x=d.x+c*Math.cos(j),k.y=d.y+c*Math.sin(j),k.theta=j,j+=i}}function Q(a,b){var c=a[b].parent;return c&&a[c].parent?a[b].children.length===0?c:null:null}function R(a,b){var c=a.extents.c,d=Math.max(a.extents.x2-a.extents.x1,a.extents.y2-a.extents.y1),e=Math.sqrt(c)*120,f=Math.max(d,e)/2,g=0;c>1&&(g=Math.min(Math.floor(f),100));var h=g*c*Math.log(c);return{gravitation:0,repulsion:.002,edgeAttraction:1*T(b),repulsionBoundary:2,repulsionBoundaryFactor:2,repulseAtDistance:!0,iterations:g,chunk:20,temperature:f,estTime:h}}function S(a,b,c){var d=Math.pow(a.repulsionBoundaryFactor,2);return bd*Math.pow(b.size*c.size*a.repulsion*d/a.edgeAttraction,1/3)}function T(a){var b=I(a.tightness);return Math.pow(2,(b-5)*3/5)}function U(a,b,c,d,e){function x(b){var c=i[b],d=q[b];ba(a,c,d,d.start,d.stop,function(){b++,b<i.length?x(b):y()})}function y(){l?W(a,f,i,p,1,j,k,c,d,e):Z(a,f,j,k,c,d,e)}var f=b.v,g=b.vcount,h=b.e,i=w(f,h),j=b.extents,k=c.fixed||[],l=c.tidy;be(f);var m=i.length,n=g/(g+m),o=0,p=l?n:1;a.trigger("progress","layout",0);var q=[],r=0;for(var s=0;s<i.length;s++){var t=R(i[s],c);r+=t.estTime,q.push(t)}var u=0;for(s=0;s<i.length;s++){q[s].start=u;var v=u+(p-o)*q[s].estTime/r;q[s].stop=v,u=v}i.length>0?x(0):Z(a,f,j,k,c,d,e)}function V(a){for(var b in a)if(a[b].fixed)return!0}function W(a,b,c,d,e,f,g,h,i,j){var k={},l=[],m={};for(var n=0;n<c.length;n++){var o=bh(c[n].verts);k[n]=o;var p=V(c[n].verts);l.push({x:o.x,y:o.y,width:o.width,height:o.height,id:n,fixed:p}),m[n]={x:o.x,y:o.y}}var q=bm(l,{strategy:h.strategy,step:30,max:2,sort:!1,ratio:h.ratio,tightness:h.tightness}).comps,r={};for(var s=0;s<q.length;s++)r[q[s].id]=q[s];for(var t in b){var u=b[t];if(!k[u.c].fixed){var v=r[u.c].x-m[u.c].x,w=r[u.c].y-m[u.c].y;u.x+=v,u.y+=w}}Z(a,b,f,g,h,i,j)}function X(a,b,c,d,e,f,g,h,i,j){var k={},l={};for(var m=0;m<c.length;m++){var n=bg(c[m].verts);k[m]={x:n.x,y:n.y,size:n.size,fixed:n.fixed,c:0,bulk:n.sum>1},l[m]=n}var o={verts:k,edges:[]};o.extents=A(k);var p=R(o);p.gravitation=10,p.repulsion=.001,p.edgeAttraction=0,p.repulsionBoundary=1,p.repulsionBoundaryFactor=1,p.repulseAtDistance=!1,ba(a,o,p,d,e,function(){for(var c in b){var d=b[c];if(!k[d.c].fixed){var e=k[d.c].x-l[d.c].x,m=k[d.c].y-l[d.c].y;d.x+=e,d.y+=m}}Z(a,b,f,g,h,i,j)})}function Z(a,b,c,d,e,f,g){var h=A(b);d.length===0&&(h=bb(b,c,h)),isNaN(h.x1)&&(h=null),a.trigger("progress","layout",1),g({vertices:b,extents:h},e,f)}function $(a,b,c){var d=a[b.id1],e=a[b.id2];if(d.fixed&&e.fixed)return;var f=S(c,a[b.id1],a[b.id2]),g=Math.random()*2*Math.PI,h=(d.x+e.x)/2,i=(d.y+e.y)/2,j=f/2;d.x=h+j*Math.cos(g),d.y=i+j*Math.sin(g),g+=Math.PI,e.x=h+j*Math.cos(g),e.y=i+j*Math.sin(g)}function _(a,b,c){var d=Math.min(a.i+c.chunk,c.iterations);while(a.i<d){var e=b.verts,f=b.edges,g=0;for(var h in e)e[h].dx=e[h].dy=0,g++;if(g===1){a.i=d;return}if(g===2){$(e,f[0],c),a.i=d;return}bk(e,c.gravitation),bl(e,c.repulsion,c.repulsionBoundary,c.repulseAtDistance,c.repulsionBoundaryFactor);for(var i=0;i<f.length;i++)bi(f[i],e,c.edgeAttraction);for(var j in e)bj(e[j],a.temperature);a.temperature*=1-a.i/c.iterations,a.i++}}function ba(a,b,c,d,e,f){function h(){return d+(e-d)*g.i/c.iterations}function i(){return g.i>=c.iterations}function j(){_(g,b,c)}function k(){j(),i()?f():(a.trigger("progress","layout",h()),setTimeout(k,0))}var g={i:0,temperature:c.temperature};k()}function bb(a,b,c){var d=(c.x1+c.x2)/2-(b.x1+b.x2)/2,e=(c.y1+c.y2)/2-(b.y1+b.y2)/2;for(var f in a)a[f].x-=d,a[f].y-=e;return{x1:c.x1-d,y1:c.y1-e,x2:c.x2-d,y2:c.y2-e}}function be(a){var b=30;for(var c in a)a[c].fixed||(a[c].x+=b*(Math.random()-.5),a[c].y+=b*(Math.random()-.5))}function bf(a){return typeof a!="undefined"}function bg(a){var b=0,c=0,d=0,e=Infinity,f=Infinity,g=-Infinity,h=-Infinity,i;for(i in a)b+=1,c+=a[i].x,d+=a[i].y,f=Math.min(f,a[i].x),e=Math.min(e,a[i].y),g=Math.max(g,a[i].x),h=Math.max(h,a[i].y);c/=b,d/=b;var j=0,k=!1;for(i in a){var l=a[i].x-c,m=a[i].y-d,n=Math.sqrt(l*l+m*m);j=Math.max(n+a[i].size*1.5,j),k=k||a[i].fixed}return{x:c,y:d,sum:b,size:j,fixed:k,miny:e,minx:f,maxy:h,maxx:g}}function bh(a,c){b.isNullOrUndefined(c)&&(c={});var d=20,e=Infinity,f=Infinity,g=-Infinity,h=-Infinity,i;for(i in a)i in c||(f=Math.min(f,a[i].x-a[i].size),e=Math.min(e,a[i].y-a[i].size),g=Math.max(g,a[i].x+a[i].size),h=Math.max(h,a[i].y+a[i].size));return f-=d,e-=d,g+=d,h+=d,{x:f,y:e,width:g-f,height:h-e}}function bi(a,b,c){var d=b[a.id1],e=b[a.id2],f=d.x-e.x,g=d.y-e.y,h=C(f,g),i=h*h/bd*c,j=f/h*i,k=g/h*i;d.dx-=j,d.dy-=k,e.dx+=j,e.dy+=k}function bj(a,b){if(!a.fixed){var c=C(a.dx,a.dy),d=a.dx/c*Math.min(c,b),e=a.dy/c*Math.min(c,b);a.x+=d,a.y+=e}}function bk(a,b){var c=bg(a);for(var d in a){var e=a[d].x-c.x,f=a[d].y-c.y,g=C(e,f);if(g>a[d].size){var h=g*g;a[d].dx-=b*e*bd*bd*c.sum/h,a[d].dy-=b*f*bd*bd*c.sum/h}}}function bl(a,b,c,d,e){function m(a,b,c,d){return{leaf:!0,nodes:{},point:null,x1:a,y1:b,x2:c,y2:d}}function n(a,b){var c=a.x1,d=a.y1,e=a.x2,f=a.y2,g=(c+e)*.5,h=(d+f)*.5,i=b.x>=g,j=b.y>=h,k=(j<<1)+i;a.leaf=!1,i?c=g:e=g,j?d=h:f=h,a=a.nodes[k]||(a.nodes[k]=m(c,d,e,f)),o(a,b)}function o(a,b){if(a.leaf){var c=a.point;c?Math.abs(c.x-b.x)+Math.abs(c.y-b.y)<.01?n(a,b):(a.point=null,n(a,c),n(a,b)):a.point=b}else n(a,b)}function p(a,b){if(!a(b)){var c=b.nodes;for(var d=0;d<4;d++)c[d]&&p(a,c[d])}}function q(a){var b=0,c=0;a.charge=0,a.size=0;if(!a.leaf){var d=a.nodes;for(var e=0;e<4;e++){var f=d[e];f&&(q(f),a.charge+=f.charge,a.size+=f.size,b+=f.charge*f.cx,c+=f.charge*f.cy)}}if(a.point){var g=y(a.point);a.charge+=a.pointCharge=g,a.size+=a.point.size,b+=g*a.point.x,c+=g*a.point.y}a.cx=a.charge?b/a.charge:0,a.cy=a.charge?c/a.charge:0}function v(a){if(a.point!==s){var b=a.cx-s.x,c=a.cy-s.y,d=1/C(b,c);if((a.x2-a.x1)*d<r)return x(s,a,a.charge,d,b,c),u++,!0;a.point&&(x(s,a.point,a.pointCharge,d,b,c),t++)}return!a.charge}function x(a,b,f,g,h,i){g>w&&(g=w);var j=1/g,k=(a.size+b.size)*c;j<k?(d?g*=e:g*=k-j,z(a,f,h,i,g)):d&&z(a,f,h,i,g)}function y(a){return bd*bd*b*a.size}function z(a,b,c,d,e){var f=a.size*b*e*e;a.dx-=c*f,a.dy-=d*f}function D(){for(var b in a)s=a[b],p(v,A)}var f,g,h,i,j=bg(a);f=j.minx,h=j.miny,g=j.maxx,i=j.maxy;var k=g-f,l=i-h;k>l?i=h+k:g=f+l;var r=.4,s,t=0,u=0,w=1e5,A=m(f,h,g,i);for(var B in a)o(A,a[B]);return q(A),D(),A.print=function(){var a=0;p(function(b){console.log(b),a++},A)},A}function bo(a,b,c){var d=bp(),e;b.canvas||(b.canvas=bq());var f=b.canvas.setDimensions(b.width,b.height),g=0,h=0;for(var i=0;i<a.length;i++){var j=a[i];j.fixed&&!1?e=f.addRect(j.width,j.height,j):e=f.addRect(j.width,j.height);if(!e.placed){d.width=0,d.height=0,d.comps.length=0,d.lowestHeightFlushedRightItem=0;break}j.x=e.offsetX,j.y=e.offsetY,d.comps.push(j),j.y+j.height>d.height&&(d.height=j.y+j.height),j.x+j.width>d.width&&(d.width=j.x+j.width);var k=j.width+j.x;if(k>h||k===h&&j.height>g)d.lowestHeightFlushedRightItem=e.lfhd,g=j.height,h=k}return c.cellsGenerated=f.cells,c.addAttempts=f.addAttempts,b.lowestFreeHeightDeficit=f.lfhDeficitSinceLastRedim(),d}function bp(){var a={width:0,height:0,area:function(){return a.width*a.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return a.width===0?Infinity:a.width/a.height}};return a}function bq(){function d(a,b){var c=k.height-a;return b-c}function e(a,c,d){if(d.leftOverW>0){k.cells+=b.rows();var e=a+d.nRequiredCellsH-1;b.insertCol(e,d.leftOverW)}if(d.leftOverH>0){k.cells+=b.cols();var f=c+d.nRequiredCellsV-1;b.insertRow(f,d.leftOverH)}for(var g=a+d.nRequiredCellsH-1;g>=a;g--)for(var h=c+d.nRequiredCellsV-1;h>=c;h--)b.setItem(g,h,!0)}function f(a,c,d,e){e.nRequiredCellsH=0,e.nRequiredCellsV=0,e.leftOverW=0,e.leftOverH=0;var f=0,g=0,h=a,i=c;while(g<d.height){h=a,f=0;while(f<d.width){if(b.item(h,i))return!1;f+=b.colWidth(h),h++}g+=b.rowHeight(i),i++}return e.nRequiredCellsH=h-a,e.nRequiredCellsV=i-c,e.leftOverW=f-d.width,e.leftOverH=g-d.height,!0}function g(a,c,d){var e=0,f=0,g=0,h=0,i=0;for(g=0;g<a;g++)e+=b.colWidth(g);for(g=0;g<c;g++)f+=b.rowHeight(g);h=d.x-e,i=d.y-f;if(h<0||i<0)return!1;if(h>0){k.cells+=b.rows();var j=b.colWidth(a)-h;b.insertCol(a,j)}if(i>0){k.cells+=b.cols();var l=b.rowHeight(c)-i;b.insertRow(c,l)}return!0}function h(a,c){return k.width=a,k.height=c,k.area=j(),b.init(a,c,!1),k}function i(a,h,i){var j={offsetX:0,offsetY:0,width:a,height:h,placed:!1},l=0,m=0,n=0,o=0,p={};if(i){while(l<b.cols()&&n<i.x)n+=b.colWidth(l),l++;while(m<b.rows()&&o<i.y)o+=b.rowHeight(m),m++;g(l-1,m-1,i),n-=b.colWidth(l),o-=b.rowHeight(m)}k.addAttempts++;var q=bs;for(;;){p={};while(m<b.rows()&&b.item(l,m))o+=b.rowHeight(m),m++;if(m<b.rows()&&d(o,j.height)<=0){if(f(l,m,j,p)){e(l,m,p),j.offsetX=n,j.offsetY=o,j.placed=!0;break}o+=b.rowHeight(m),m++}var r=d(o,j.height);r>0&&(o=0,m=0,n+=b.colWidth(l),l++,k.lfhDeficitSinceLastRedim()>r&&(c=r));if(k.width-n<j.width){j.placed=!1;break}}return q=c,{offsetX:j.offsetX,offsetY:j.offsetY,lfhd:q,placed:j.placed}}function j(){return k.width*k.height}var a=0,b=br(),c=bs,k={matrix:b,cells:a,addAttempts:0,addRect:i,lfhDeficitSinceLastRedim:function(){return c},setDimensions:h};return k}function br(){function g(){if(a.length>0||c.length>0)a.length=0,c.length=0,d.length=0}function h(b,h,i){if(b>0){if(h>0)return e=1,f=1,g(),a.push({index:0,size:b}),c.push({index:0,size:h}),d[0]=[],d[0][0]=i,l;throw"[Matrix] Row size cannot be 0 or similar"}throw"[Matrix] Column size cannot be 0 or similar"}function i(a,b){var g=c[a].index;for(var h=0;h<f;h++)d[h][e]=d[h][g];return a<e-1&&c.splice(a+1,0,{index:e,size:b}),c[a+1]={index:e,size:b},c[a].size-=b,e++,l}function j(c,e){var g=d[0].length,h=a[c].index;return d[f]=b.clone(d[h]),c<f-1&&a.splice(c+1,0,{index:f,size:e}),a[c+1]={index:f,size:e},a[c].size-=e,f++,l}function k(){var b="\n     ",d,g,h,i=0,j=0;for(i=0;i<f;i++)d=Math.floor(a[i].size/100)%10===0?" ":""+Math.floor(a[i].size/100)%10,g=Math.floor(a[i].size/10)%10===0&&d===" "?" ":""+Math.floor(a[i].size/10)%10,h=Math.floor(a[i].size)%10===0&&d===" "&&g===" "?" ":""+Math.floor(a[i].size)%10,b+=a[i].size>999?" "+a[i].size+" ":" "+d+""+g+""+h+" ";b+="\n";for(i=0;i<e;i++){d=Math.floor(c[i].size/100)%10===0?" ":""+Math.floor(c[i].size/100)%10,g=Math.floor(c[i].size/10)%10===0&&d===" "?" ":""+Math.floor(c[i].size/10)%10,h=Math.floor(c[i].size)%10===0&&d===" "&&g===" "?" ":""+Math.floor(c[i].size)%10,b+=c[i].size>999?" "+c[i].size+": ":" "+d+""+g+""+h+": ";for(j=0;j<f;j++)b+=l.item(j,i)?"  X  ":"  .  ";b+="\n"}return b}var a=[],c=[],d=[],e=0,f=0,l={init:h,cols:function(){return f},rows:function(){return e},item:function(b,e){return d[a[b].index][c[e].index]},setItem:function(b,e,f){d[a[b].index][c[e].index]=f},insertRow:i,insertCol:j,colWidth:function(b){return a[b].size},rowHeight:function(a){return c[a].size},inspect:k};return l}var a;typeof KeyLinesExports!="undefined"?a=exports:(this.KeyLines=this.KeyLines||{},a=this.KeyLines.Layouts={});var b=typeof KeyLinesRequire!="undefined"?require("./util"):this.KeyLines.Util,n=40,o=a.resetConnectionOffsets=function(a,b){function c(a,b){return a[0].link.id1===b[0].link.id1&&a[0].link.id2===b[0].link.id2||a[0].link.id2===b[0].link.id1&&a[0].link.id1===b[0].link.id2}var d=r(a),e=r(b),f={};for(var g=0;g<e.length;g++)for(var h=0;h<d.length;h++)if(c(d[h],e[g])){f[h]=1;break}q(d,f)},p=a.resetAllConnectionOffsets=function(a){var b=r(a),c={};for(var d=0;d<b.length;d++)c[d]=1;q(b,c)};a.setUpUninitializedConnections=function(a){var b=r(a),c={};for(var d=0;d<b.length;d++){var e=!1,f=b[d];if(f.length>1){for(var g=0;g<f.length;g++)f[g].link&&(e=e||typeof f[g].link.off!="undefined");e||(c[d]=1)}}q(b,c)};var r=a.connectionMaker=function(a){var b=[],c={},d,e;for(var f in a){var g=a[f];if(!g.hi){var h={id:f,link:g};d=g.id1<g.id2?g.id1:g.id2,e=g.id1<g.id2?g.id2:g.id1,c[d]||(c[d]={}),c[d][e]||(c[d][e]=[]),c[d][e].push(h)}}for(d in c)for(var i in c[d])b.push(c[d][i]);return b},x=a.extractStructure=function(a,b,c,d,e,f){var g=null;if(e){g={};for(var h=0;h<e.length;h++)g[e[h]]=1}var i=v(a,b,c,d,g,f);return i.extents=A(i.v),y(i),i};a.layout=function(a,b,c,e,f,g){b.trigger("prechange","layout"),z(c),a==="standard"&&U(b,c,e,f,g),a==="hierarchy"&&K(b,c,e,f,g),a==="structural"&&d(b,c,e,f,g),a==="radial"&&K(b,c,e,f,g,O)};var Y=function(a,b){return{x1:Math.min(a.x1,b.x1),y1:Math.min(a.y1,b.y1),x2:Math.max(a.x2,b.x2),y2:Math.max(a.y2,b.y2)}},bc=1e-4,bd=50;a.arrange=function(a,c,d,e,f,g){function h(a,b){var c,d=[];for(c=0;c<b.length;c++)a[b[c]]&&d.push(b[c]);return d}function i(a,b,c,d){var e;for(e=0;e<a.length;e++)if(a[e].id===b){a[e].x=c-a[e].width/2,a[e].y=d-a[e].height/2;break}return a}function n(a,b,c,d){var e={},g=[],h={},i="#arranged#";for(p=0;p<a.length;p++)h=bh(a[p].verts,b),isFinite(h.width)&&(g.push({x:h.x,y:h.y,width:h.width,height:h.height,id:p}),e[p]={x:h.x,y:h.y});h=bh(b),g.push({x:h.x,y:h.y,width:h.width,height:h.height,id:i}),e[i]={x:h.x,y:h.y};var j=u(g,{ratio:f.ratio,centre:c,absolute:d,specialId:i});return{packed:j,original:e}}function o(a,b,c){var d="#arranged#",e,f;for(var g in a){var h=a[g];h.arranged?(e=c[d].x-b[d].x,f=c[d].y-b[d].y):(e=c[h.c].x-b[h.c].x,f=c[h.c].y-b[h.c].y),h.x+=e,h.y+=f}}var j={tidy:function(a,b){return bn(a,{step:30,max:2,sort:!1,ratio:b.ratio}).comps},average:function(a,b){return i(a,b.specialId,b.centre.x,b.centre.y)},absolute:function(a,b){return i(a,b.specialId,b.absolute.x,b.absolute.y)}},l={grid:function(a,b,c,d){var e=2*c+24+d,f=0,g=0,h=Math.floor(Math.sqrt(a.length)),i=Math.ceil(a.length/h),j={};for(p=0;p<h;p++){for(q=0;q<i;q++){var k=i*p+q;a[k]&&(j[a[k]]={x:f,y:g}),f+=e}f=0,g+=e}return j},circle:function(a,b,c,d){var e=1.25-(d-5)/50;return m(b,a,c,e).positions},radial:function(a,b,c,d){var e=1.25-(d-5)/50;return k(b,a,c,e).positions}},p,q,r;f=b.defaults(f,{tightness:5,position:"average",x:0,y:0}),c.trigger("prechange","arrange"),z(e);var s=e.v,t=J(f.tightness),u=j[f.position]||j.average,v=l[a]||l.grid,x={x:Number(f.x)||0,y:Number(f.y)||0},y={x:0,y:0};d=h(s,d);if(!d.length)return;r=0;for(p=0;p<d.length;p++)r+=s[d[p]].size,y.x+=s[d[p]].x,y.y+=s[d[p]].y;r/=d.length,y.x/=d.length,y.y/=d.length;var A=v(d,s,r,t),B={};for(var C in A)s[C].x=A[C].x,s[C].y=A[C].y,B[C]=s[C],B[C].arranged=1;var D=w(s,e.e),E=n(D,B,y,x),F=E.packed,G=E.original,H={};for(p=0;p<F.length;p++)H[F[p].id]=F[p];o(s,G,H);var I=[],K=e.extents;Z(c,s,K,I,f,!1,g)};var bm=function(a,c){function d(){return Math.random()*2-1+(Math.random()*2-1)+(Math.random()*2-1)}function e(a,b,c){return(b-a)*c+a}function f(a,b,c){return(a-c)/(b-c)}function g(){var a=new Date/6e4&4294967295,b=new Date&4294967295,c=a||362436069,d=b||521288629,e=function(){return c=36969*(c&65535)+(c>>>16)&4294967295,d=18e3*(d&65535)+(d>>>16)&4294967295,((c&65535)<<16|d&65535)&4294967295},f=[0,0,0,0,0,Math.PI/2,Math.PI/2],g=Math.abs(e()%7);return f[g]}function h(a,b){var c;b===Math.PI/2&&(c=a.width,a.width=a.height,a.height=c,a.theta=b)}function i(a){var b=function(){var b=0,c=-Infinity;for(var d=0;d<a.length;d++)b+=a[d].width*a[d].height,c=Math.max(c,a[d].width);return{area:b,maxWidth:c}},d=1.1,e=1.03,f=10,g=b(),h=Math.sqrt(g.area*d/c.ratio)*e,i=h*c.ratio,j=0;return i<g.maxWidth+f&&(i=g.maxWidth+f),{x:0,y:0,width:i,height:h}}function j(a,b,c,d,g,h){var i=f(b,c,d);return i=Math.pow(i,a),e(h,g,i)}function k(a,b){if(!b)return!1;var c=a.x<t.x+t.width,d=a.x+a.width>t.x,e=a.y<t.y+t.height,f=a.y+a.height>t.y;return c||d&&e||f}function l(a,b){function c(a,b){var c=a.y<b.y+b.height,d=a.y+a.height>b.y;return c&&d}function d(a,b){var c=a.x<b.x+b.width,d=a.x+a.width>b.x;return c&&d}if(b.length<1)return!1;var e,f;for(e=0;e<b.length;e++){f=b[e];if(d(a,f)&&c(a,f))return!0}return!1}function m(a,b){return a.fixed&&!b.fixed?-1:b.fixed&&!a.fixed?1:0}var n={spiral:function(a){var b=j(.6,a,100,0,w,1),c=j(1,a,600,0,.3,.5),d=c*a,e=Math.cos(d)*b,f=Math.sin(d)*b;return{x:e,y:f}},controlled:function(a,b){var c;while(!k(b,c))c=n.random(a);return c},rect:function(a){return bn(a,c)},random:function(a){var b=a*.5;return{x:d()*b,y:d()*b}}};c=b.defaults(c,{strategy:"rect",ratio:4/3});var o,p,q,r,s=0,t=i(a),u=[],v=n[c.strategy]||n.rect,w=0;for(o=0;o<a.length;o++)p=a[o],w+=p.width;w/=2*a.length;if(c.strategy.match(/^rect$/))return v(a);a.sort(m);for(o=0;o<a.length;o++){p=a[o],p.x=p.fixed?p.x:0,p.y=p.fixed?p.y:0;while(l(p,u)&&!p.fixed)r=v(s,p),p.x=r.x,p.y=r.y,s++;u.push(p)}return{comps:u,stats:{cellsGenerated:s,addAttempts:s}}},bn=a.pack=function(a,c){function d(){var b=0;for(var c=0;c<a.length;c++)b+=a[c].width*a[c].height;return b}function e(a,b){var c=f(a,b);return c?c:a.height>b.height?-1:a.height<b.height?1:0}function f(a,b){return a.fixed&&!b.fixed?-1:b.fixed&&!a.fixed?1:0}function g(a){var b=0;for(var c=0;c<a.length;c++)b<a[c].width&&(b=a[c].width);return b}function h(a){var d=b.clone(a);for(var e=0;e<d.length;e++){var f=d[e].width%c.step,g=d[e].height%c.step;f!==0&&(d[e].width=d[e].width+(c.step-f)),g!==0&&(d[e].height=d[e].height+(c.step-g))}return d}function i(a,b){var c={isBigger:function(){return s.width*s.height>a},isSmallerThanAll:function(){return s.width*s.height<b},isFeasable:function(){return!c.isBigger()&&!c.isSmallerThanAll()}};return c}function j(a){return o?a.ratio()>=c.ratio-.2&&a.ratio()<=c.ratio:!0}function k(a,b){var c;for(var d=0;d<a.length;d++)b(c,a[d])&&(c=a[d]);return c}function l(a){var b=J(c.tightness);for(var d=0;d<a.length;d++)a[d].width+=b,a[d].height+=b}function m(a,b){var d=1.1,e=1.03,f=10,g=Math.sqrt(a.area()*d/c.ratio)*e,h=g*c.ratio,i=0;return h<a.maxWidth+f&&(h=a.maxWidth+f),{width:h,height:g,lowestFreeHeightDeficit:0,ratio:function(){return s.width/s.height}}}c=b.defaults(c,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),c.sort&&a.sort(e),l(a);var n=h(a),o=!0,p={candidatesFailure:0,candidatesOk:0,addAttempts:0,cellsGenerated:0,candidatesAccepted:0,totalTime:0},q;if(a.length===0)return q=bp(),q.stats=p,q;var r={area:d,maxWidth:g(n),maxHeight:n[0].height},s=m(r,n),t=(new Date).getTime();while(s.width>=r.maxWidth){var u=bo(n,s,p);if(u.comps.length===0)p.candidatesFailure++,s.width*=1.03,s.height*=1.03;else{p.candidatesOk++;if(!q||j(u)){p.candidatesAccepted++,q=u,q.efficiency=r.area()/u.area();if(j(u))break}if(p.candidatesOk>=c.max)break}}var v=(new Date).getTime();return p.totalTime=Math.floor(v-t),q.stats=p,q},bs=16e6})();

